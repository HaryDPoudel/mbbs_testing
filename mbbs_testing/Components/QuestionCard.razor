@using mbbs_testing.Models
@inherits ComponentBase

<div class="quiz-card">

    <div class="quiz-header">
        <h3>Question @QuestionIndex of @TotalQuestions</h3>
    </div>

    <div class="quiz-question">
        <p>@Question.question</p>
    </div>

    <div class="quiz-options">
        @foreach (var opt in Options)
        {
            <button class="@GetOptionClass(opt)"
                    @onclick="() => AnswerSelected(opt)"
                    disabled="@ShowFeedback">
                @opt
            </button>
        }
    </div>

    @if (ShowFeedback)
    {
        <div class="quiz-feedback">
            <p>@FeedbackMessage</p>
            <button class="next-btn" @onclick="OnNextQuestion">Next Question</button>
        </div>
    }
</div>

@code {
    [Parameter] public QuestionItem Question { get; set; }
    [Parameter] public int QuestionIndex { get; set; }
    [Parameter] public int TotalQuestions { get; set; }
    [Parameter] public EventCallback<string> OnSelectAnswer { get; set; }
    [Parameter] public EventCallback OnNextQuestion { get; set; }
    [Parameter] public bool ShowFeedback { get; set; }
    [Parameter] public string? FeedbackMessage { get; set; }

    private List<string> Options => new()
    {
        Question.opa, Question.opb, Question.opc, Question.opd
    };

    private async Task AnswerSelected(string opt)
    {
        await OnSelectAnswer.InvokeAsync(opt);
    }

    private string GetOptionClass(string opt)
    {
        if (!ShowFeedback) return "quiz-option";

        string correct = Question.opc;

        if (opt == correct) return "quiz-option correct";

        if (opt != correct && FeedbackMessage?.StartsWith("Wrong!") == true)
            return "quiz-option wrong";

        return "quiz-option disabled";
    }
}
